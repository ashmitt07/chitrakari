<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TX ESP32 Control</title>
<style>
body {
    margin:0;
    padding:20px;
    font-family:'Segoe UI', sans-serif;
    background:#0f172a;
    color:#fff;
    text-align:center;
}
h2 { font-size:42px; margin-bottom:25px; color:#f0f0f0;}
h3 { font-size:28px; margin:20px 0 10px 0; color:#ddd;}
.card { display:inline-block; background:#1e293b; margin:15px; padding:20px; border-radius:15px; }
.icon { font-size:40px; margin-bottom:10px;}
.toggle-btn { background:#3b82f6; color:#fff; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;}
.timer-input select { margin:0 2px;}
.timer-display { margin-top:10px; font-size:14px; color:#aaa;}
.readings h1 { margin:10px 0;}
</style>
</head>
<body>

<h2>Transmitter Control</h2>

<div class="container">
  <div class="card">
    <div id="icon1" class="icon">ðŸ’¡</div>
    <div class="label">ROSHNI YANTRA 1</div>
    <button onclick="toggle(1)">Toggle</button>
  </div>
  <div class="card">
    <div id="icon2" class="icon">ðŸ’¡</div>
    <div class="label">ROSHNI YANTRA 2</div>
    <button onclick="toggle(2)">Toggle</button>
  </div>
  <div class="card">
    <div id="icon3" class="icon">ðŸŒ€</div>
    <div class="label">Pankha</div>
    <button onclick="toggle(3)">Toggle</button>
  </div>
</div>

<div class="readings">
  <h1>Taapmaan: <span id="temp">--</span> Â°C</h1>
  <h1>Nami: <span id="hum">--</span> %</h1>
  <h1>Gas: <span id="gas">--</span></h1>
</div>

<h3>OLED Drawing</h3>
<canvas id="oledCanvas" width="128" height="64" style="border:1px solid white; width:512px; height:256px;"></canvas>
<div>
  <button onclick="sendDrawing()">Send</button>
  <button onclick="clearCanvas()">Clear</button>
  <button onclick="undo()">Undo</button>
  <button onclick="redo()">Redo</button>
</div>

<script>
// === ESP32 ka IP yaha daalna ===
const ESP32_IP = "http://192.168.1.105";  // replace with your ESP32 IP

function toggle(n){
  fetch(`${ESP32_IP}/toggle?led=${n}`);
}

// live sensor update
setInterval(()=>{
  fetch(`${ESP32_IP}/status`)
    .then(r=>r.json())
    .then(j=>{
      document.getElementById("temp").innerText = j.temp;
      document.getElementById("hum").innerText = j.hum;
      document.getElementById("gas").innerText = j.gas;
    });
},2000);

// ===== Canvas Drawing =====
let canvas = document.getElementById("oledCanvas");
let ctx = canvas.getContext("2d");
let drawing = false;
let points = [];
let undoStack = [], redoStack = [];

canvas.addEventListener("mousedown", ()=>drawing=true);
canvas.addEventListener("mouseup", ()=>{drawing=false; undoStack.push([...points]);});
canvas.addEventListener("mousemove", e=>{
  if(!drawing) return;
  let rect = canvas.getBoundingClientRect();
  let x = Math.floor((e.clientX-rect.left)/rect.width*128);
  let y = Math.floor((e.clientY-rect.top)/rect.height*64);
  ctx.fillStyle="white";
  ctx.fillRect(x,y,1,1);
  points.push({x,y});
});

function sendDrawing(){
  fetch(`${ESP32_IP}/draw`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(points)
  });
}
function clearCanvas(){
  ctx.clearRect(0,0,128,64);
  points=[];
  fetch(`${ESP32_IP}/clear`);
}
function undo(){
  if(undoStack.length==0) return;
  redoStack.push(undoStack.pop());
  ctx.clearRect(0,0,128,64);
  points = undoStack.flat();
  points.forEach(p=>ctx.fillRect(p.x,p.y,1,1));
}
function redo(){
  if(redoStack.length==0) return;
  let redoPts = redoStack.pop();
  undoStack.push(redoPts);
  redoPts.forEach(p=>ctx.fillRect(p.x,p.y,1,1));
  points = undoStack.flat();
}
</script>
</body>
</html>

